# üáªüá™ SISTEMA NIEA-EJB

<div align="center">

![Badge](https://img.shields.io/badge/Ej√©rcito_Bolivariano-Sistema_NIEA--EJB-red?style=for-the-badge)
![Badge](https://img.shields.io/badge/Python-Backend-blue?style=for-the-badge&logo=python)
![Badge](https://img.shields.io/badge/Flask-Framework-green?style=for-the-badge&logo=flask)
![Badge](https://img.shields.io/badge/PostgreSQL-Database-blue?style=for-the-badge&logo=postgresql)
![Badge](https://img.shields.io/badge/JWT-Authentication-orange?style=for-the-badge)

**Sistema de Gesti√≥n Militar Integrado con Autenticaci√≥n JWT**

</div>

---

## üìã Descripci√≥n

**SISTEMA NIEA-EJB** es una soluci√≥n inform√°tica robusta y especializada, dise√±ada para facilitar y optimizar la evaluaci√≥n integral de los profesionales militares que son candidatos para ascenso en el Ej√©rcito Bolivariano. Este sistema proporciona herramientas avanzadas para la recopilaci√≥n, procesamiento y an√°lisis de datos, garantizando un proceso de evaluaci√≥n eficaz, eficiente y estandarizado seg√∫n los protocolos militares.

### ‚ú® Caracter√≠sticas Principales
- üîê **Autenticaci√≥n JWT**: Sistema de autenticaci√≥n seguro con tokens JWT
- üõ†Ô∏è **Instalaci√≥n Automatizada**: API REST para instalaci√≥n completa del sistema
- üìä **Estructura de Evaluaci√≥n**: Sistema completo de aspectos, variables, indicadores, especificidades y subespecificidades
- üîí **APIs Protegidas**: Todas las APIs requieren autenticaci√≥n JWT
- üìÅ **Instalaci√≥n Modular**: Scripts SQL organizados por tabla

## üöÄ Tecnolog√≠as Utilizadas

### Backend
- **üêç Python 3.8+**: Lenguaje de programaci√≥n principal
- **üåê Flask**: Framework web ligero y potente
- **üîê PyJWT**: Manejo de tokens JWT para autenticaci√≥n
- **üîí bcrypt**: Hashing seguro de contrase√±as
- **üåê API RESTful**: Arquitectura de comunicaci√≥n entre servicios

### Base de Datos
- **üêò PostgreSQL 12+**: Sistema de gesti√≥n de base de datos relacional
- **üìä Estructura NIEA**: Tablas especializadas para evaluaci√≥n militar

## üõ†Ô∏è Instalaci√≥n y Configuraci√≥n

### Prerrequisitos
- Python 3.8+
- PostgreSQL 12+
- pip (gestor de paquetes de Python)

### Pasos de Instalaci√≥n

1. **Clonar el repositorio**
   ```bash
   git clone https://github.com/elpoloxrodriguez/niea-ejb
   cd NIEA-EJB
   ```

2. **Configurar entorno virtual**
   ```bash
   # Crear entorno virtual
   python3 -m venv venv
   source venv/bin/activate  # En Windows: venv\Scripts\activate
   ```

3. **Instalar dependencias**
   ```bash
   pip install -r requirements.txt
   ```

4. **Configurar PostgreSQL**
   ```bash
   # Crear base de datos
   psql -U postgres -c "CREATE DATABASE niea_db;"
   
   # Configurar variables de entorno (opcional)
   export DB_HOST=localhost
   export DB_PORT=5432
   export DB_NAME=niea_db
   export DB_USER=postgres
   export DB_PASSWORD=tu_password
   export SECRET_KEY=tu_clave_secreta_jwt
   ```

5. **Iniciar el servidor**
   ```bash
   python3 app.py
   ```
   *El servidor estar√° disponible en: `http://localhost:5001`*

## üöÄ Instalaci√≥n Autom√°tica del Sistema

### M√©todo 1: API REST (Recomendado)

```bash
# Instalar todas las tablas y datos iniciales
curl -X POST http://localhost:5001/v1/api/install \
  -H "Content-Type: application/json" \
  -d '{}'
```

**Respuesta exitosa:**
```json
{
  "status": "success",
  "message": "Sistema instalado correctamente",
  "data": {
    "installation_completed": true,
    "details": [
      "‚úÖ Todas las tablas instaladas correctamente",
      "‚úÖ Usuario administrador creado",
      "‚úÖ Datos iniciales cargados"
    ]
  }
}
```

### M√©todo 2: Script Python

```bash
# Ejecutar instalaci√≥n desde l√≠nea de comandos
python3 setup_database.py
```

### Verificar Instalaci√≥n

```bash
# Verificar estado de la instalaci√≥n
curl http://localhost:5001/v1/api/install/status
```

```bash
# Verificar salud del sistema
curl http://localhost:5001/v1/api/install/health
```

## API Endpoints

### Autenticaci√≥n

#### POST /v1/api/auth/login
Autenticaci√≥n de usuario y obtenci√≥n de token JWT.

```bash
curl -X POST http://localhost:5001/v1/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**Respuesta exitosa:**
```json
{
  "status": "success",
  "count": 150,
  "data": [
    {
      "cedula": "12345678",
      "grado_actual": "TTE",
      "categoria": "OFICIAL"
    }
  ],
  "metadata": {
    "tabla_origen": "niea_ejb.candidatos",
    "orden": "ASC",
    "campos_consulta": ["cedula", "grado_actual", "categoria"]
  }
}
```

### Seleccionados

#### POST /v1/api/seleccionados
Obtener y procesar candidatos para ascenso seg√∫n criterios espec√≠ficos.

```bash
curl -X POST http://localhost:5001/v1/api/seleccionados \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "fecha": "2025-01-15",
    "grado": "TTE",
    "categoria": "OFICIAL"
  }'
```

**Par√°metros requeridos:**
- `fecha`: Fecha de consulta (YYYY-MM-DD)
- `grado`: C√≥digo del grado militar
- `categoria`: Categor√≠a (OFICIAL, SUBOFICIAL, etc.)

**Respuesta exitosa:**
```json
{
  "metadata": {
    "fecha_consulta": "2025-01-15",
    "grado_solicitado": "TTE",
    "categoria_solicitada": {
      "codigo": "OFICIAL",
      "descripcion": "Oficiales del Ej√©rcito"
    },
    "total_candidatos": 25,
    "guardado_db": true,
    "estructura_tabla": {
      "nombre": "niea_ejb.candidatos",
      "registros_nuevos": 25
    }
  },
  "candidatos": [
    {
      "cedula": "12345678",
      "nombre_completo": "Juan P√©rez",
      "grado_actual": "TTE",
      "anos_en_grado": 3.5
    }
  ]
}
```

### Estructura de Evaluaci√≥n

#### GET /v1/api/estructura-evaluacion
Obtener la estructura completa de evaluaci√≥n NIEA.

```bash
curl -X GET http://localhost:5001/v1/api/estructura-evaluacion
```

**Respuesta exitosa:**
```json
{
  "status": "success",
  "data": {
    "aspectos": [
      {
        "id": 1,
        "nombre": "Liderazgo",
        "descripcion": "Capacidad de liderazgo militar",
        "peso": 25
      }
    ],
    "variables": [
      {
        "id": 1,
        "aspecto_id": 1,
        "nombre": "Iniciativa",
        "descripcion": "Capacidad de tomar iniciativa"
      }
    ]
  },
  "timestamp": "2025-07-23T22:45:00"
}
```

#### POST /v1/api/actualizar-estructura
Actualizar cache de estructura de evaluaci√≥n.

```bash
curl -X POST http://localhost:5001/v1/api/actualizar-estructura
```

### Instalaci√≥n del Sistema

#### POST /v1/api/install
Instalaci√≥n completa del sistema NIEA-EJB.

```bash
curl -X POST http://localhost:5001/v1/api/install \
  -H "Content-Type: application/json" \
  -d '{}'
```

#### GET /v1/api/install/status
Verificar estado de instalaci√≥n del sistema.

```bash
curl -X GET http://localhost:5001/v1/api/install/status
```

#### GET /v1/api/install/health
Verificar salud del sistema.

```bash
curl -X GET http://localhost:5001/v1/api/install/health
```

#### POST /v1/api/install/reset
Reset completo del sistema (requiere confirmaci√≥n).

```bash
curl -X POST http://localhost:5001/v1/api/install/reset \
  -H "Content-Type: application/json" \
  -d '{
    "confirm_reset": true,
    "reset_password": "MIA_INTELLIGENCE_NIEA_2025"
  }'
```

### Resumen de Endpoints

| Endpoint | M√©todo | Descripci√≥n | Autenticaci√≥n |
|----------|--------|-------------|---------------|
| `/v1/api/auth/login` | POST | Iniciar sesi√≥n | No |
| `/v1/api/auth/verify` | POST | Verificar token | S√≠ |
| `/v1/api/auth/profile` | GET | Perfil del usuario | S√≠ |
| `/v1/api/auth/create-user` | POST | Crear usuario | S√≠ (Admin) |
| `/v1/api/auth/logout` | POST | Cerrar sesi√≥n | S√≠ |
| `/v1/api/candidatos` | GET | Obtener candidatos | S√≠ |
| `/v1/api/seleccionados` | POST | Procesar candidatos | S√≠ |
| `/v1/api/estructura-evaluacion` | GET | Estructura NIEA | No |
| `/v1/api/actualizar-estructura` | POST | Actualizar cache | No |
| `/v1/api/install` | POST | Instalar sistema | No |
| `/v1/api/install/status` | GET | Estado instalaci√≥n | No |
| `/v1/api/install/health` | GET | Salud del sistema | No |
| `/v1/api/install/reset` | POST | Reset sistema | No |

## üöÄ Despliegue a Producci√≥n

### Requisitos del Sistema

#### Hardware M√≠nimo
- **CPU**: 4 cores
- **RAM**: 8 GB
- **Disco**: 50 GB SSD
- **Red**: Conexi√≥n estable a base de datos PostgreSQL

#### Software Requerido
- **OS**: Ubuntu 20.04 LTS o superior
- **Python**: 3.8+
- **PostgreSQL**: 12+
- **Redis**: 6.0+ (opcional, para cache)
- **Nginx**: 1.18+
- **Certificados SSL**: Para HTTPS

### Preparaci√≥n del Entorno

#### 1. Configurar Variables de Entorno

Editar el archivo `.env.production` con los valores espec√≠ficos de producci√≥n:

```bash
# Copiar archivo de ejemplo
cp .env.production .env.production.local

# Editar configuraci√≥n
nano .env.production.local
```

**Variables cr√≠ticas a configurar:**
```bash
# Base de datos
DB_HOST=127.0.0.1
DB_NAME=ejercito
DB_USER=ejercito
DB_PASSWORD=TU_PASSWORD_SEGURO

# JWT (CAMBIAR OBLIGATORIAMENTE)
JWT_SECRET_KEY=TU_CLAVE_SECRETA_SUPER_SEGURA_2025

# SSL
SSL_CERT_PATH=/etc/ssl/certs/niea-ejb.crt
SSL_KEY_PATH=/etc/ssl/private/niea-ejb.key

# Email (opcional)
SMTP_PASSWORD=tu_password_smtp
```

#### 2. Preparar Certificados SSL

```bash
# Generar certificados autofirmados (desarrollo)
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/ssl/private/niea-ejb.key \
  -out /etc/ssl/certs/niea-ejb.crt

# O usar certificados de CA v√°lida (recomendado)
sudo cp tu-certificado.crt /etc/ssl/certs/niea-ejb.crt
sudo cp tu-clave-privada.key /etc/ssl/private/niea-ejb.key
sudo chmod 600 /etc/ssl/private/niea-ejb.key
```

### Despliegue Automatizado

#### Opci√≥n 1: Script de Despliegue Completo

```bash
# Ejecutar como root
sudo ./deploy/deploy.sh
```

Este script realiza:
- ‚úÖ Instalaci√≥n de dependencias del sistema
- ‚úÖ Creaci√≥n de usuario del sistema
- ‚úÖ Configuraci√≥n de entorno virtual Python
- ‚úÖ Instalaci√≥n de la aplicaci√≥n
- ‚úÖ Configuraci√≥n de base de datos
- ‚úÖ Configuraci√≥n de servicios systemd
- ‚úÖ Configuraci√≥n de Nginx
- ‚úÖ Configuraci√≥n de firewall
- ‚úÖ Configuraci√≥n de logs y monitoreo
- ‚úÖ Verificaci√≥n del despliegue

### APIs de Instalaci√≥n (No requieren JWT)

| Endpoint | M√©todo | Descripci√≥n |
|----------|--------|-----------|
| `/v1/api/install` | POST | Instalar sistema completo |
| `/v1/api/install/status` | GET | Estado de instalaci√≥n |
| `/v1/api/install/health` | GET | Salud del sistema |
| `/v1/api/install/reset` | POST | Resetear sistema (placeholder) |

## üìä Estructura de Base de Datos

### Tablas del Sistema NIEA

1. **users** - Usuarios del sistema
2. **candidatos** - Informaci√≥n de candidatos
3. **seleccionados** - Personal seleccionado
4. **estructura** - Estructura organizacional
5. **cursos_militares** - Cursos de formaci√≥n militar
6. **cursos_civiles** - Cursos de formaci√≥n civil
7. **idiomas** - Competencias en idiomas
8. **trabajo_institucional** - Trabajo institucional
9. **aspectos** - Aspectos de evaluaci√≥n
10. **variables** - Variables de medici√≥n
11. **indicadores** - Indicadores de evaluaci√≥n
12. **especificidades** - Especificidades de evaluaci√≥n
13. **subespecificidades** - Subespecificidades detalladas

### Estructura de Evaluaci√≥n NIEA

```
Aspectos
‚îú‚îÄ‚îÄ Variables
‚îÇ   ‚îú‚îÄ‚îÄ Indicadores
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Especificidades
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Subespecificidades
```

## üîß Funcionalidades Principales

- üîê **Autenticaci√≥n JWT**: Sistema de autenticaci√≥n seguro con tokens de 24 horas
- üõ†Ô∏è **Instalaci√≥n Automatizada**: API REST para instalaci√≥n completa del sistema
- üìä **Estructura de Evaluaci√≥n**: Sistema jer√°rquico completo de evaluaci√≥n militar
- üîí **APIs Protegidas**: Todas las APIs principales requieren autenticaci√≥n JWT
- üìÅ **Instalaci√≥n Modular**: Scripts SQL organizados por tabla para f√°cil mantenimiento
- üë§ **Gesti√≥n de Usuarios**: Creaci√≥n y gesti√≥n de usuarios con roles
- üîç **Verificaci√≥n de Sistema**: Endpoints para verificar estado y salud del sistema
- üîÑ **Reset de Contrase√±a**: Script automatizado para solucionar problemas de autenticaci√≥n

## üõ†Ô∏è Mantenimiento del Sistema

### Resetear Contrase√±a de Administrador

Si no puedes hacer login con las credenciales por defecto:

```bash
python3 reset_admin_password.py
```

**Salida esperada:**
```
üöÄ Iniciando reset completo de contrase√±a admin...
============================================================
üîÑ Eliminando usuario admin existente...
‚úÖ Usuario admin eliminado
üîê Generando nuevo hash para contrase√±a: admin123
‚úÖ Hash generado (longitud: 60)
üìù Insertando nuevo usuario admin...
‚úÖ Usuario admin recreado exitosamente
‚úÖ Usuario encontrado con ID: X
üîç Verificando contrase√±a...
‚úÖ Verificaci√≥n de contrase√±a exitosa
üß™ Probando autenticaci√≥n completa...
‚úÖ Autenticaci√≥n completa exitosa para: admin
============================================================
üéâ RESET COMPLETADO EXITOSAMENTE
üîê Credenciales:
   Username: admin
   Password: admin123
============================================================
```

### Verificaci√≥n de Funcionamiento

Despu√©s del reset, verifica que la autenticaci√≥n funcione:

```bash
# Probar login
curl -X POST http://localhost:5001/v1/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'
```

**Respuesta esperada:**
```json
{
  "status": "success",
  "message": "Login exitoso",
  "data": {
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "token_type": "Bearer",
    "expires_in": 86400,
    "user": {
      "id": 4,
      "username": "admin",
      "email": "admin@niea-ejb.mil",
      "full_name": "Administrador Sistema",
      "role": "admin"
    }
  }
}
```

#### üìÅ Archivos Clave
- `authentication.py` - M√≥dulo de autenticaci√≥n JWT
- `routes/auth.py` - Endpoints de autenticaci√≥n
- `routes/install.py` - API de instalaci√≥n
- `setup_database.py` - L√≥gica de instalaci√≥n
- `reset_admin_password.py` - Script de reset de contrase√±a
- `sql/` - Scripts SQL modulares (13 archivos)

#### üîê Estado Actual
- **Sistema**: Completamente funcional
- **Autenticaci√≥n**: Operativa con JWT
- **Base de Datos**: 13 tablas instaladas
- **APIs**: Todas protegidas y funcionales
- **Documentaci√≥n**: Completa y actualizada

### Comandos de Verificaci√≥n R√°pida

```bash
# 1. Verificar instalaci√≥n
curl http://localhost:5001/v1/api/install/status

# 2. Verificar salud del sistema
curl http://localhost:5001/v1/api/install/health

# 3. Login admin
curl -X POST http://localhost:5001/v1/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# 4. Probar API protegida (usar token del paso 3)
curl -X GET http://localhost:5001/v1/api/candidatos \
  -H "Authorization: Bearer TU_TOKEN_JWT"
```

## ü§ù Contribuci√≥n

Las contribuciones son bienvenidas y valoradas. Para contribuir:

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## üë®‚Äçüíº Autor

**Mayor Andr√©s Ricardo Rodr√≠guez Dur√°n**
- üìß Email: [elpoloxrodriguez@gmail.com](mailto:elpoloxrodriguez@gmail.com)
- üì± Tel√©fono: +58 412-996-7096
- üèõÔ∏è Ej√©rcito Bolivariano de Venezuela

## üè¢ Colaboraci√≥n Empresarial

Este proyecto ha sido desarrollado en colaboraci√≥n con:

**BUNKER TECHNOLOGIES SOLUTIONS C.A**
- Empresa especializada en soluciones tecnol√≥gicas
- Soporte t√©cnico y desarrollo de sistemas

---

## üìú Licencia

Este proyecto est√° desarrollado para uso exclusivo del Ej√©rcito Bolivariano de Venezuela.

---

<div align="center">

**Desarrollado para la Patria Grande**

*"Independencia y Patria Socialista. Viviremos y Venceremos"*

</div>
